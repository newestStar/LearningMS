{% extends "lms/templates/lms_base.html" %}
{% block title %}
    {{  _("All Classes") }}
{% endblock %}

{% block page_content %}
<div class="common-page-style lms-page-style">
	<div class="container">
		{% if is_moderator %}
		<button class="btn btn-secondary btn-sm pull-right" id="create-class">
			{{ _("Create Class") }}
		</button>
		{% endif %}
		<div class="course-home-headings"> {{ _("All Classes") }} </div>
		{% if past_classes | length or upcoming_classes | length %}
		{{ ClassTabs(past_classes, upcoming_classes) }}
		{% else %}
		<div class="empty-state">
			<img class="icon icon-xl" src="/assets/lms/icons/comment.svg">
			<div class="empty-state-text">
				<div class="empty-state-heading">{{ _("No Classes") }}</div>
				<div class="course-meta">{{ _("Nothing to see here.") }}</div>
			</div>
		</div>
		{% endif %}
	</div>
</div>
{% endblock %}

{% macro ClassTabs(past_classes, upcoming_classes) %}
<article>
	<ul class="nav lms-nav" id="courses-tab">

		<li class="nav-item">
			<a class="nav-link active" data-toggle="tab" href="#upcoming">
				{{ _("Upcoming") }} ({{ upcoming_classes | length }})
			</a>
		</li>

		<li class="nav-item">
			<a class="nav-link" data-toggle="tab" href="#past">
				{{ _("Past Classes") }} ({{ past_classes | length }})
			</a>
		</li>

	</ul>

	<div class="border-bottom mb-4"></div>

	<div class="tab-content">
		<div class="tab-pane active" id="upcoming" role="tabpanel" aria-labelledby="upcoming">
			{{ ClassCards(upcoming_classes) }}
		</div>

		<div class="tab-pane" id="past" role="tabpanel" aria-labelledby="past">
			{{ ClassCards(past_classes) }}
		</div>

	</div>
</article>
{% endmacro %}

{% macro ClassCards(classes) %}
<div class="lms-card-parent">
	{% for class in classes %}
	{% set course_count = frappe.db.count("Class Course", {"parent": class.name}) %}
    {% set student_count = frappe.db.count("Class Student", {"parent": class.name}) %}

	<div class="lms-card">

		<div class="text-muted small mb-2">
			{% if course_count %}
			<span class="mr-3">
				{{ course_count }} {{ _("Courses") }}
			</span>
			{% endif %}

			{% if student_count %}
			<span>
				{{ student_count }} {{ _("Students") }}
			</span>
			{% endif %}

			{% if class.seats_left %}
			<span class="indicator-pill yellow pull-right">
				{{ class.seats_left }} {{ _("seats left") }}
			</span>
			{% endif  %}
		</div>

		<div class="lms-card-title mb-4">
			{{ class.title }}
		</div>

		<div class="">
			<svg class="icon icon-sm">
				<use href="#icon-calendar"></use>
			</svg>
			<span>
				{{ frappe.utils.format_date(class.start_date, "long") }} -
			</span>
			<span>
				{{ frappe.utils.format_date(class.end_date, "long") }}
			</span>
		</div>

		{% if class.paid_class and class.start_date > frappe.utils.getdate() %}
		<a class="btn btn-secondary btn-sm mt-4">
			{{ _("Register") }}
		</a>
		{% endif  %}

		<a class="stretched-link" href="/classes/{{ class.name }}"></a>
	</div>
	{% endfor %}
</div>
{% endmacro %}

{%- block script %}
    {{ super() }}
    {{ include_script('controls.bundle.js') }}
	{% if is_moderator %}
	<script>
		let class_info = null;
	</script>
	{% endif %}
{% endblock %}