{% extends "templates/base.html" %}
{% from "www/macros/livecode.html" import LiveCodeEditorJS, LiveCodeEditor with context %}
{% block title %}{{ lesson.title }}{% endblock %}

{% block head_include %}
<meta name="description" content="{{lesson.title}} - {{course.title}}" />
<meta name="keywords" content="{{lesson.title}} - {{course.title}}" />
<style>
</style>

<link rel="stylesheet" href="/assets/frappe/css/font-awesome.css">
<link rel="stylesheet" href="/assets/css/lms.css">
<link rel="stylesheet" href="/assets/frappe/css/hljs-night-owl.css">

{% for ext in page_extensions %}
  {{ ext.render_header() }}
{% endfor %}

{% endblock %}


{% block content %}

<div class="container">
  {{ widgets.BatchTabs(course=course, batch=batch) }}
  <div class="lesson-page">

    <h2 class="title {% if course.is_mentor(frappe.session.user) %} is_mentor {% endif %}" data-name="{{ lesson.name }}" data-batch="{{ batch.name }}">{{ lesson.title }}</h2>

    {{ lesson.render_html() }}

    {{ pagination(prev_chap, prev_url, next_chap, next_url) }}
  </div>
</div>
{% endblock %}


{% macro pagination(prev_chap, prev_url, next_chap, next_url) %}
<div class="lesson-pagination">
  {% if prev_url %}
  <span>
    Prev: <a href="{{prev_url}}">{{prev_chap}}</a>
  </span>
  {% endif %}
  {% if next_url %}
  <span class="pull-right">
    Next: <a href="{{next_url}}">{{next_chap}}</a>
  </span>
  {% endif %}
  <div style="clear: both;"></div>
</div>
{% endmacro %}

{%- block script %}
{{ super() }}
  <script type="text/javascript">
    $(function() {
      var batch_name = "{{ batch.name }}";
      var lesson_name = "{{ lesson.name }}";

      frappe.call("community.lms.api.save_current_lesson", {
        "batch_name": batch_name,
        "lesson_name": lesson_name
      })
    })
  </script>

{% for ext in page_extensions %}
  {{ ext.render_footer() }}
{% endfor %}

{%- endblock %}
