<div class="modal fade discussion-modal" id="discussion-modal" tabindex="-1" role="dialog" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <div class="course-home-headings modal-headings">Start a Discussion</div>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="discussions">

          <form class="discussion-form" id="discussion-form">


            <div class="form-group">
              <div class="control-input-wrapper">
                <div class="control-input">
                  <input type="text" autocomplete="off" class="input-with-feedback form-control topic-title"
                    data-fieldtype="Data" data-fieldname="feedback_comments" placeholder="Title"
                    spellcheck="false"></input>
                </div>
              </div>
            </div>

            <div class="form-group">
              <div class="control-input-wrapper">
                <div class="control-input">
                  <textarea type="text" autocomplete="off" class="input-with-feedback form-control comment-field"
                    data-fieldtype="Text" data-fieldname="feedback_comments" placeholder="Enter a comment..."
                    spellcheck="false"></textarea>
                </div>
              </div>
            </div>
            <div class="comment-footer">
              <div class="button is-secondary pull-right mb-5" id="submit-discussion"
                data-doctype="{{ doctype | urlencode }}" data-docname="{{ docname | urlencode }}">
                Post</div>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  frappe.ready(() => {
    $("#submit-discussion").click((e) => {
      submit_discussion(e);
    })
  })

  var submit_discussion = (e) => {
    var title = $(".topic-title").val().trim();
    var reply = $(".comment-field").val().trim();

    if (reply) {
      var doctype = $(e.currentTarget).attr("data-doctype");
      doctype = doctype ? decodeURIComponent(doctype) : doctype;

      var docname = $(e.currentTarget).attr("data-docname");
      docname = docname ? decodeURIComponent(docname) : docname;

      frappe.call({
        method: "community.community.doctype.discussion_topic.discussion_topic.submit_discussion",
        args: {
          "doctype": doctype ? doctype : "",
          "docname": docname ? docname : "",
          "reply": reply,
          "title": title,
          "topic_name": $(e.currentTarget).attr("data-topic")
        },
        callback: (data) => {
        }
      })

    }
  }
</script>
